<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS Test</title>
</head>
<body>
    <h1>TTS Test</h1>
    <button onclick="testBrowserTTS()">Test Browser TTS</button>
    <button onclick="testBackendTTS()">Test Backend TTS</button>
    <div id="status"></div>

    <script>
        async function testBrowserTTS() {
            const status = document.getElementById('status');
            status.textContent = 'Testing browser TTS...';
            
            try {
                if (!window.speechSynthesis) {
                    throw new Error('Speech synthesis not supported');
                }
                
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance('Hello, this is a test of browser text to speech');
                utterance.lang = 'en-US';
                utterance.rate = 0.95;
                utterance.volume = 1.0;
                
                utterance.onstart = () => status.textContent = 'Browser TTS speaking...';
                utterance.onend = () => status.textContent = 'Browser TTS completed!';
                utterance.onerror = (e) => status.textContent = `Browser TTS error: ${e.error}`;
                
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                status.textContent = `Browser TTS failed: ${error.message}`;
            }
        }
        
        async function testBackendTTS() {
            const status = document.getElementById('status');
            status.textContent = 'Testing backend TTS...';
            
            try {
                const response = await fetch('/api/tts/synthesize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: 'Hello, this is a test of backend text to speech',
                        language: 'en-US'
                    }),
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('TTS Data:', data);
                
                if (data.success && data.audio) {
                    // Create audio blob from base64 data
                    const audioBytes = atob(data.audio);
                    const audioBuffer = new ArrayBuffer(audioBytes.length);
                    const audioView = new Uint8Array(audioBuffer);
                    
                    for (let i = 0; i < audioBytes.length; i++) {
                        audioView[i] = audioBytes.charCodeAt(i);
                    }
                    
                    // Create blob with correct MIME type
                    const blob = new Blob([audioBuffer], { type: data.mimeType || 'audio/L16;codec=pcm;rate=24000' });
                    const audioUrl = URL.createObjectURL(blob);
                    
                    const audio = new Audio(audioUrl);
                    audio.volume = 1.0;
                    
                    audio.onplay = () => status.textContent = 'Backend TTS playing...';
                    audio.onended = () => {
                        status.textContent = 'Backend TTS completed!';
                        URL.revokeObjectURL(audioUrl);
                    };
                    audio.onerror = (e) => {
                        status.textContent = `Backend TTS audio error: ${e.message || 'Unknown error'}`;
                        URL.revokeObjectURL(audioUrl);
                    };
                    
                    await audio.play();
                } else {
                    throw new Error('TTS synthesis failed');
                }
            } catch (error) {
                status.textContent = `Backend TTS failed: ${error.message}`;
                console.error('Backend TTS error:', error);
            }
        }
    </script>
</body>
</html>
